<!DOCTYPE html>
<html 
xmlns:th="http://www.thymeleaf.org"
xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
layout:decorate="~{fragments/layout/layout.html}">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <title>íƒ€ì´í‹€</title>
</head>
<body>
<main layout:fragment="content">
  <div class="container">
    <div class="row text-center">
      <div class="col-1 border">1</div>
      <div class="col-1 border">2</div>
      <div class="col-1 border">3</div>
      <div class="col-1 border">4</div>
      <div class="col-1 border">5</div>
      <div class="col-1 bg-warning border">6</div>
      <div class="col-1 bg-warning border">7</div>
      <div class="col-1 border">8</div>
      <div class="col-1 border">9</div>
      <div class="col-1 border">10</div>
      <div class="col-1 border">11</div>
      <div class="col-1 border">12</div>
    </div>
  </div>
  <div class="bg-white border-bottom py-2 d-flex justify-content-center gap-4 small fw-semibold">
    <div> <span class="text-dark">êµ­ë‚´</span> <span class="text-muted">Â· ì¥ ë‹«í˜</span> </div>
    <div> <span class="text-dark">í•´ì™¸</span> <span class="text-muted">Â· ì¥ ë‹«í˜</span> </div>
  </div>
<div class="container mt-4">
  <div class="row gx-5">
    <!-- ì™¼ìª½ ì½˜í…ì¸  -->
    <div class="col-lg-9">
      <div class="container">
        <div th:if="${krwTotal != null}">
          <div style="display: flex; justify-content: center; gap: 40px; margin-top: 40px; ">
            <div style="width: 400px">
              <canvas id="typeChart"></canvas>
            </div>
            <div style="width: 400px">
              <canvas id="assetChart"></canvas>
            </div>
          </div>
        </div>
      </div>
      <!-- ë°ì´í„°ê°€ ìˆì„ ê²½ìš°ë§Œ í…Œì´ë¸” ë³´ì—¬ì¤Œ -->
      <div th:if="${not #lists.isEmpty(comparisonList)}">
        <table class="table mt-4">
          <thead>
            <tr>
              <th>ìì‚°</th>
              <th>í†µí™”</th>
              <th>í˜„ì¬ ë¹„ì¤‘</th>
              <th>ëª©í‘œ ë¹„ì¤‘</th>
              <th>ì°¨ì´</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="row : ${comparisonList}">
              <td th:text="${row.as_asset_type}"></td>
              <td th:text="${row.as_currency}"></td>
              <td th:text="${row.current_percent + '%'}"></td>
              <td th:text="${row.ta_target_percent + '%'}"></td>
              <td th:text="${row.gap_percent > 0 ? '+' + row.gap_percent + '%' : row.gap_percent + '%'}"></td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="d-flex justify-content-center">
        <div class="text-center text-danger fw-bold">
          ì—¬ê¸°ì— ìš”ì•½í•´ì„œ ì•Œë ¤ì¤Œ ê°€ì¥ ë§ì´ ë²—ì–´ë‚œ ìˆœìœ¼ë¡œ % ì¶œë ¥
        </div>
      </div>
      <!-- ë°ì´í„° ì—†ì„ ê²½ìš° ê²½ê³  ì¶œë ¥ -->
      <div th:if="${#lists.isEmpty(comparisonList)}" class="alert alert-warning text-center">
        ì•„ì§ ë“±ë¡ëœ ë¦¬ë°¸ëŸ°ì‹± ëª©í‘œê°€ ì—†ê±°ë‚˜ ìì‚° ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
      </div>

  </div>
  <!-- ì˜¤ë¥¸ìª½ ì‚¬ì´ë“œ íŒ¨ë„ -->
  <div class="col-lg-2 border-start ps-4">
    <!-- ğŸ”¹ ì§€ìˆ˜ íƒ€ì´í‹€ ë°•ìŠ¤ -->
    <div class="bg-light px-3 py-2 rounded-pill" style="display: inline-block;">
      <h6 class="text-muted mb-0">ì§€ìˆ˜</h6>
  </div>
  
  <!-- ğŸ”¹ ì§€í‘œ ë¦¬ìŠ¤íŠ¸ ì˜ì—­ -->
  <div class="pt-2">
    <div class="d-flex justify-content-between">
      <div class="text-muted">í™˜ìœ¨</div>
      <span class="text-danger">2,626.87</span>
    </div>
    <div class="d-flex justify-content-between">
      <div class="text-muted">ë‚˜ìŠ¤ë‹¥ ğŸ”º</div>
      <span class="text-danger">2,626.87</span>
    </div>
    <div class="d-flex justify-content-between">
      <div class="text-muted">S&P 500</div>
      <span class="text-danger">2,626.87</span>
    </div>
    <div class="d-flex justify-content-between">
      <div class="text-muted">VIX ğŸ”»</div>
      <span class="text-danger">2,626.87</span>
    </div>
  </div>
</div>
</main>
<th:block layout:fragment="script">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
  <script th:inline="javascript">
    Chart.register(ChartDataLabels);
    const krwTotal = [[${krwTotal}]];         // ì˜ˆ: 6915
    const usdTotal = [[${usdTotal}]];         // ì˜ˆ: 8
    const exchangeRate = [[${exchangeRate}]]; // ì˜ˆ: 1375.39
    const usdToWon = usdTotal * exchangeRate;

    const data = {
      labels: ['KRW ë¹„ì¤‘', 'USD ë¹„ì¤‘'],
      datasets: [{
        label: 'ìì‚° ë¹„ì¤‘',
        data: [krwTotal, usdToWon],
        backgroundColor: ['#36A2EB', '#4BC0C0'],
        hoverOffset: 25
      }]
    };

    const config = {
      type: 'doughnut',
      data: data,
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'bottom' },
          title: {
            display: true,
            text: 'ìì‚° ë¹„ì¤‘ ë¹„êµí•˜ê¸°',
            font: {
              size: 24,
              weight: 'bold'
            },
            padding: {
              top: 20,
              bottom: 10
            }
          },
          tooltip: {
            callbacks: {
              label: function(context) {
                const label = context.label;
                const value = context.raw;
                const formatted = Math.round(value).toLocaleString('ko-KR');
                return `${label}: ${formatted} ì›`;
              }
            }
          },
          datalabels: {
            color: '#fff',
            font: {
              weight: 'bold',
              size: 28
            },
            formatter: (value, context) => {
              const total = context.chart._metasets[0].total;
              const percent = Math.round((value / total) * 100);
              return percent + '%';
            }
          }
        }
      },
      plugins: [ChartDataLabels]
    };
    // ìƒˆ ì°¨íŠ¸
    new Chart(document.getElementById('assetChart'), config);
    const typeLabels = /*[[${typeLabels}]]*/ [];
    const typeValues = /*[[${typeValues}]]*/ [];
    const typeAmounts = /*[[${typeAmounts}]]*/ [];
    const typeCurrencies = /*[[${typeCurrencies}]]*/ [];
    const typeData = {
      labels: typeLabels,
      datasets: [{
        data: typeValues, // ê¸ˆì•¡ ì›ë³¸
        backgroundColor: [
          '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'
        ],
        hoverOffset: 25
      }]
    };

      const typeConfig = {
      type: 'doughnut',
      data: typeData,
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'bottom' },
          title: {
            display: true,
            text: 'ìì‚° ìœ í˜•ë³„ ë¹„ì¤‘',
            font: { size: 24, weight: 'bold' }
          },
          tooltip: {
            callbacks: {
              label: function(context) {
                const label = context.label;
                const idx = context.dataIndex;
                const amount = typeAmounts[idx];
                const currency = typeCurrencies[idx];
                const formatted = Math.round(amount).toLocaleString('ko-KR');
                const unit = currency === 'USD' ? 'ë‹¬ëŸ¬' : 'ì›';
                return `${label}: ${formatted} ${unit}`;
              }
            }
          }
          ,
          datalabels: {
            color: '#fff',
            font: { size: 18, weight: 'bold' },
            formatter: function(value, context) {
              const total = context.chart._metasets[0].total;
              const percent = (value / total) * 100;
              return percent.toFixed(1) + '%';
            }
          }
        }
      },
      plugins: [ChartDataLabels]
    };
    new Chart(document.getElementById('typeChart'), typeConfig);
  </script>
</th:block>
</body>
</html>