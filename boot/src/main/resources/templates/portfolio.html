<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{fragments/layout/layout.html}"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <title>회원가입</title>
  </head>
  <body>
    <main layout:fragment="content">
      <div class="container mt-5">
        <h2 class="mb-4">포트폴리오</h2>
        <div th:if="${krwTotal != null}">
          <p>KRW 자산 합계: <span th:text="${krwTotal}"></span> 원</p>
          <p>USD 자산 합계: <span th:text="${usdTotal}"></span> 달러</p>
          <p>
            달러 원화가치:
            <span
              th:text="${usdTotal} + ' * ' + ${exchangeRate} + ' = ' + ${wonValue}"
            ></span>
          </p>
          <!-- <p>KRW 비중: <span th:text="${krwPercent} + '%'"></span></p> -->
          <!-- <p>USD 비중: <span th:text="${usdPercent} + '%'"></span></p> -->
          <div style="width: 500px; margin: 0 auto">
            <canvas id="assetChart"></canvas>
          </div>
        </div>
      </div>
    </main>

    <th:block layout:fragment="script">
      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      <script
        src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"
      ></script>

      <script th:inline="javascript">
        Chart.register(ChartDataLabels);

        const krwPercent = [[${krwPercent}]];
        const usdPercent = [[${usdPercent}]];

        const data = {
          labels: ['KRW 비중', 'USD 비중'],
          datasets: [{
            label: '자산 비중',
            data: [krwPercent, usdPercent],
            backgroundColor: ['#36A2EB', '#4BC0C0'],
            hoverOffset: 10
          }]
        };

        const config = {
          type: 'doughnut',
          data: data,
          options: {
            responsive: true,
            plugins: {
              legend: { position: 'bottom' },
              title: { display: true, text: '자산 비중 비교하기' },
              datalabels: {
                color: '#fff',
                font: {
                  weight: 'bold',
                  size: 14
                },
                formatter: (value) => value + '%'
              }
            }
          },
          plugins: [ChartDataLabels]
        };

        new Chart(document.getElementById('assetChart'), config);
      </script>
    </th:block>
  </body>
</html>
