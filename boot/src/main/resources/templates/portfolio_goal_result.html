<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
layout:decorate="~{fragments/layout/layout.html}">
<head><title>ëª©í‘œ ê¸ˆì•¡ ì„¤ì •</title>
</head>
<main layout:fragment="content">
  <style>
    .chart-wrapper {
      max-width: 1000px;
      margin: 0 auto;
    }
  </style>

  <div class="container mt-4">
    <h2 class="text-center">ğŸ¯ ëª©í‘œ ë‹¬ì„± ì‹œë®¬ë ˆì´ì…˜</h2>
    <div class="text-center mt-4">
      <p>ğŸ’° ì›ê¸ˆ: <strong th:text="${#numbers.formatInteger(totalWon, 0, 'COMMA')} + ' ì›'"></strong></p>
      <p>ğŸ¯ ëª©í‘œ ê¸ˆì•¡: <strong th:text="${#numbers.formatInteger(goal, 3, 'COMMA')} + ' ì›'"></strong></p>
      <p>ğŸ“ˆ ë„ë‹¬ ì‹œì : <strong th:text="${years} + 'ë…„'"></strong></p>
      <p>ğŸ’° ë„ë‹¬ ì‹œ ëˆ„ì  ìì‚°: <strong th:text="${#numbers.formatInteger(finalAmount, 3, 'COMMA')} + ' ì›'"></strong></p>
      <p>âœ… ì„¸ì „ ì—° í‰ê·  ê¸°ëŒ€ ìˆ˜ìµë¥ ì€ 
      <strong th:text="${#numbers.formatDecimal((expectedReturn - 1.0) * 100, 1, 2) + '%'}"></strong>
      <!-- <p>ğŸ“‰ ì„¸í›„ ì‹¤ì§ˆ ìˆ˜ìµë¥ :  -->
      <!-- <strong th:text="${#numbers.formatDecimal(expectedReturnRateAfterTax, 1, 2)} + '%'"></strong> -->
      <!-- </p> -->
      <!-- <p>ğŸ’¸ ë¶€ê³¼ëœ ì„¸ê¸ˆ ì´ì•¡:  -->
      <!-- <strong th:text="${#numbers.formatInteger(calculatedTax, 0, 'COMMA')} + ' ì›'"></strong> -->
      <!-- </p> -->
    </div>
  </div>
  <div class="chart-wrapper">
    <canvas id="myChart"></canvas>
    <canvas id="compoundChart" width="800" height="400"></canvas>

  </div>
  <div class="mt-4 text-center">
    <a href="/portfolio/goal" class="btn btn-secondary btn-lg">ëŒì•„ê°€ê¸°</a>
  </div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const nominalAssets = [[${yearlyAssets}]];
  const realAssets = nominalAssets.map((val, idx) => Math.round(val * Math.pow(0.9757, idx)));
  const cumulativeProfits = [[${cumulativeProfits}]];
  const labels = cumulativeProfits.map((_, i) => i + 'ë…„');

  // ìì‚° ì¦ê°€ ì‹œë®¬ë ˆì´ì…˜ (Line Chart)
  const chart = new Chart(document.getElementById('myChart'), {
    type: 'line',
    data: {
      datasets: [
        {
          label: 'ëª…ëª© ìì‚°',
          borderColor: 'rgba(255,99,132,1)',
          borderWidth: 2,
          radius: 3,
          backgroundColor: 'rgba(255,99,132,0.3)',
          data: nominalAssets.map((y, x) => ({x, y}))
        },
        {
          label: 'ì‹¤ì§ˆ ìì‚°',
          borderColor: 'rgba(54,162,235,1)',
          borderWidth: 2,
          radius: 3,
          backgroundColor: 'rgba(54,162,235,0.3)',
          data: realAssets.map((y, x) => ({x, y}))
        }
      ]
    },
    options: {
      animation: false,
      interaction: {
        intersect: false,
        mode: 'index',
        axis: 'x'
      },
      plugins: {
        legend: { display: true },
        title: { display: true, text: 'ìì‚° ì¦ê°€ ì‹œë®¬ë ˆì´ì…˜' },
        tooltip: {
          enabled: true,
          mode: 'index',
          intersect: false,
          callbacks: {
            title: function(tooltipItems) {
              return tooltipItems[0].parsed.x + 'ë…„';
            },
            label: function(tooltipItem) {
              const label = tooltipItem.dataset.label || '';
              const value = tooltipItem.raw.y;
              const formatted = Number(value).toLocaleString();
              return `${label}: ${formatted}ì›`;
            }
          }
        }
      },
      scales: {
        x: {
          type: 'linear',
          title: { display: true, text: 'ì—°ë„' },
          ticks: {
            callback: function(value) {
              return value + 'ë…„';
            }
          }
        },
        y: {
          title: { display: true, text: 'ìì‚° (ì›)' }
        }
      }
    }
  });

  // ë³µë¦¬ ëˆ„ì  ìˆ˜ìµ ì´í•© (Bar Chart)
  new Chart(document.getElementById('compoundChart'), {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'ë³µë¦¬ ëˆ„ì  ìˆ˜ìµ ì´í•©',
        data: cumulativeProfits,
        backgroundColor: 'rgba(255, 206, 86, 0.6)',
        borderColor: 'rgba(255, 206, 86, 1)',
        borderWidth: 1
      }]
    },
    options: {
      plugins: {
        title: {
          display: true,
          text: 'ëˆ„ì  ìˆ˜ìµ ì´í•©',
          font: { size: 18 }
        },
        legend: { display: true },
        tooltip: {
          callbacks: {
            label: function(tooltipItem) {
              const label = tooltipItem.dataset.label || '';
              const value = tooltipItem.raw;
              const formatted = Number(value).toLocaleString();
              return `${label}: ${formatted}ì›`;
            }
          }
        }
      },
      scales: {
        x: {
          title: { display: true, text: 'ì—°ë„' },
          ticks: {
            callback: function(value) {
              return value + 'ë…„';
            }
          }
        },
        y: {
          title: { display: true, text: 'ëˆ„ì  ìˆ˜ìµ (ì›)' },
          beginAtZero: true
        }
      }
    }
  });
</script>
</main>
</html>
