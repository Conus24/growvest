<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{fragments/layout/layout.html}" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <title>리밸런싱 목표 비중</title>
</head>
<body>
<main layout:fragment="content">
  <div class="container mt-5">
    <h2 class="mb-4">자산 목표 비중 설정</h2>

    <form id="targetForm" th:action="@{/rebalancing/submit}" method="post">
      <div class="mb-3">
        <label for="ta_end_date" class="form-label">목표 달성 날짜</label>
        <input type="date" class="form-control" name="ta_end_date" required />
      </div>

      <div class="mb-3" id="sliderContainer">
        <!-- 각 자산 슬라이더 생성 -->
        <div class="mb-3">
          <label class="form-label">현금 (원): <span id="cashWonVal">0%</span></label>
          <input type="range" class="form-range" name="cashWon" min="0" max="100" value="0" oninput="updateValue(this, 'cashWonVal')">
        </div>
        <div class="mb-3">
          <label class="form-label">현금 (달러): <span id="cashDollarVal">0%</span></label>
          <input type="range" class="form-range" name="cashDollar" min="0" max="100" value="0" oninput="updateValue(this, 'cashDollarVal')">
        </div>
        <div class="mb-3">
          <label class="form-label">예적금: <span id="depositsVal">0%</span></label>
          <input type="range" class="form-range" name="deposits" min="0" max="100" value="0" oninput="updateValue(this, 'depositsVal')">
        </div>
        <div class="mb-3">
          <label class="form-label">채권: <span id="bondVal">0%</span></label>
          <input type="range" class="form-range" name="bond" min="0" max="100" value="0" oninput="updateValue(this, 'bondVal')">
        </div>
        <div class="mb-3">
          <label class="form-label">금: <span id="goldVal">0%</span></label>
          <input type="range" class="form-range" name="gold" min="0" max="100" value="0" oninput="updateValue(this, 'goldVal')">
        </div>
        <div class="mb-3">
          <label class="form-label">ETF: <span id="etfVal">0%</span></label>
          <input type="range" class="form-range" name="etf" min="0" max="100" value="0" oninput="updateValue(this, 'etfVal')">
        </div>
        <div class="mb-3 text-center">
          현재 합계: <span id="totalPercent">0%</span>
        </div>
      </div>
      <div class="alert alert-danger d-none" id="errorBox">총합이 100%가 되어야 합니다.</div>
      <button type="submit" class="btn btn-primary">목표 저장</button>
    </form>
  </div>
</main>
<th:block layout:fragment="script">
  <script th:inline="javascript">
    function updateValue(slider, labelId) {
      document.getElementById(labelId).textContent = slider.value + "%";
      updateTotal(); // 실시간 합계 업데이트
    }

    function updateTotal() {
      const sliders = document.querySelectorAll("input[type='range']");
      let sum = 0;
      sliders.forEach(slider => sum += parseFloat(slider.value));
      document.getElementById("totalPercent").textContent = sum + "%";

      const errorBox = document.getElementById("errorBox");
      if (Math.round(sum) === 100) {
        errorBox.classList.add("d-none");
      }
    }

    document.addEventListener("DOMContentLoaded", function () {
      document.querySelectorAll("input[type='range']").forEach(slider => {
        const labelId = slider.getAttribute("oninput").match(/'([^']+)'/)[1];
        updateValue(slider, labelId);
      });
    });

    document.getElementById("targetForm").addEventListener("submit", function (e) {
      const sliders = document.querySelectorAll("input[type='range']");
      let sum = 0;
      sliders.forEach(slider => sum += parseFloat(slider.value));

      if (Math.round(sum) !== 100) {
        e.preventDefault();
        document.getElementById("errorBox").classList.remove("d-none");
      }
    });
  </script>
</th:block>
</body>
</html>
