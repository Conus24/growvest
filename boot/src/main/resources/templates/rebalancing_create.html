<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/layout/layout.html}">
<head><title>ë¦¬ë°¸ëŸ°ì‹± ì„¤ì •</title></head>
<main layout:fragment="content">
  <div class="container mt-5">
    <div class="row justify-content-center">
      <div class="col-md-6"> <!-- ğŸŒŸ ì „ì²´ í¼ ë„ˆë¹„ ì¡°ì ˆ -->
        <h2 class="mb-4">ìì‚° ëª©í‘œ ë¹„ì¤‘ ì„¤ì •</h2>
        <form id="targetForm" th:action="@{/rebalancing/submit}" method="post">
          <div class="mb-3">
            <label for="ta_end_date" class="form-label">ëª©í‘œ ë‹¬ì„± ë‚ ì§œ</label>
            <input type="date" class="form-control" name="ta_end_date" id="ta_end_date" required />
          </div>

          <div class="mb-3">
            <label class="form-label">í˜„ê¸ˆ (ì›):</label>
            <div class="input-group">
              <input type="number" class="form-control percent-input" name="cashWon" min="0" max="100" value="0">
              <span class="input-group-text">%</span>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">í˜„ê¸ˆ (ë‹¬ëŸ¬):</label>
            <div class="input-group">
              <input type="number" class="form-control percent-input" name="cashDollar" min="0" max="100" value="0">
              <span class="input-group-text">%</span>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">ì˜ˆì ê¸ˆ:</label>
            <div class="input-group">
              <input type="number" class="form-control percent-input" name="deposits" min="0" max="100" value="0">
              <span class="input-group-text">%</span>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">ì±„ê¶Œ:</label>
            <div class="input-group">
              <input type="number" class="form-control percent-input" name="bond" min="0" max="100" value="0">
              <span class="input-group-text">%</span>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">ê¸ˆ:</label>
            <div class="input-group">
              <input type="number" class="form-control percent-input" name="gold" min="0" max="100" value="0">
              <span class="input-group-text">%</span>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">S&P 500 (VOO):</label>
            <div class="input-group">
              <input type="number" class="form-control percent-input" name="voo" min="0" max="100" value="0">
              <span class="input-group-text">%</span>
            </div>
          </div>

          <div class="mb-3 text-center">
            í˜„ì¬ í•©ê³„: <span id="totalPercent">0%</span><br>
            ë°˜ë“œì‹œ 100%ë¡œ ì œì¶œ
          </div>

          <div class="alert alert-danger d-none" id="errorBox">ì´í•©ì´ 100%ê°€ ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.</div>

          <div class="mb-3 text-center">
            <button type="submit" class="btn btn-primary">ëª©í‘œ ì €ì¥</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</main>

<th:block layout:fragment="script">
  <script th:inline="javascript">
    function updateTotalPercent() {
      const inputs = document.querySelectorAll(".percent-input");
      let sum = 0;
      inputs.forEach(input => {
        const val = parseFloat(input.value) || 0;
        sum += val;
      });

      document.getElementById("totalPercent").textContent = Math.round(sum) + "%";
      const errorBox = document.getElementById("errorBox");
      if (Math.round(sum) === 100) {
        errorBox.classList.add("d-none");
      } else {
        errorBox.classList.remove("d-none");
      }
    }

    document.addEventListener("DOMContentLoaded", function () {
      updateTotalPercent();

      // ë‚ ì§œ ê¸°ë³¸ê°’ ì„¤ì • (ì˜¤ëŠ˜ + 3ê°œì›”)
      const dateInput = document.getElementById("ta_end_date");
      const now = new Date();
      now.setMonth(now.getMonth() + 3);
      const yyyy = now.getFullYear();
      const mm = String(now.getMonth() + 1).padStart(2, '0');
      const dd = String(now.getDate()).padStart(2, '0');
      dateInput.value = `${yyyy}-${mm}-${dd}`;

      // ìˆ«ì ì…ë ¥ ì‹œ í•©ê³„ ì—…ë°ì´íŠ¸
      document.querySelectorAll(".percent-input").forEach(input => {
        input.addEventListener("input", updateTotalPercent);
      });
    });

    document.getElementById("targetForm").addEventListener("submit", function (e) {
      const inputs = document.querySelectorAll(".percent-input");
      let sum = 0;
      inputs.forEach(input => sum += parseFloat(input.value) || 0);

      if (Math.round(sum) !== 100) {
        e.preventDefault();
        document.getElementById("errorBox").classList.remove("d-none");
      }
    });
  </script>
</th:block>
</html>
